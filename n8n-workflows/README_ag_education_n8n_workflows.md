# Agricultural Education n8n Workflows

This package contains three n8n workflow JSON files that implement the backend for your agricultural educational platform. They integrate **Supabase** for data storage and **Zep** for temporal memory, knowledge graphs and AI-powered recommendations. The workflows are configured to operate in the **America/Chicago** time zone.

## Contents

- **ag_learning_event_processor.json** – Handles incoming learning events from your app, enriches them with metadata, stores them in Supabase, updates the Zep memory service, and triggers recommendations when high‑quality learning occurs.
- **ag_knowledge_graph_analyzer.json** – Runs every six hours to analyze each active student's knowledge graph, identify skill gaps and learning patterns, store learning analytics, and generate recommendations and engagement reminders.
- **ag_recommendation_generator.json** – Generates personalised recommendations when triggered (e.g. by high‑quality learning or external events), fetches relevant data from Supabase and Zep, and stores the resulting recommendations and notifications.

## Importing the Workflows

1. **Log in to your n8n instance** (cloud or self‑hosted).
2. Navigate to the **Workflows** section and choose **Import from JSON** for each of the three JSON files:
   - ag_learning_event_processor.json
   - ag_knowledge_graph_analyzer.json
   - ag_recommendation_generator.json
3. Paste the JSON content (or upload the file, depending on your n8n version) and click **Import**. Save each workflow when prompted.
4. After import, each workflow will create a unique Webhook URL. Copy these URLs for later integration with your Expo Go app and backend services.

## Environment Variables

Before activating the workflows, set the following variables in your n8n instance (e.g. in the `.env` file or environment settings):

```bash
# Zep memory configuration
ZEP_API_URL=https://api.getzep.com
ZEP_API_KEY=<your-zep-api-key>

# Supabase configuration
SUPABASE_URL=<your-supabase-project-url>
SUPABASE_ANON_KEY=<your-supabase-anon-key>
SUPABASE_SERVICE_ROLE_KEY=<your-supabase-service-key>
SUPABASE_CREDENTIAL_ID=<n8n-credential-id-for-supabase>

# n8n webhook base (matches your n8n instance URL)
N8N_WEBHOOK_BASE=https://<your-n8n-domain>/webhook

# Webhook URLs (copied after importing workflows)
N8N_LEARNING_EVENT_WEBHOOK=<auto-generated learning-event webhook URL>
N8N_KNOWLEDGE_GRAPH_WEBHOOK=<auto-generated knowledge-graph webhook URL>
N8N_RECOMMENDATION_WEBHOOK=<auto-generated recommendation-generator webhook URL>
```

If you use OpenAI for AI‑driven recommendations, also set your OpenAI API key:

```bash
OPENAI_API_KEY=<your-openai-key>
```

## Backend Integration

- **Expo Go app / API routes** – Call the `N8N_LEARNING_EVENT_WEBHOOK` whenever a student logs a health record, journal entry or other learning event. Include `student_id`, `event_type`, `content`, and optional metadata (e.g. `animal_id`, `competency`, `location`, `supervisor`).
- **Recommendation triggers** – To manually trigger recommendations, POST to the `N8N_RECOMMENDATION_WEBHOOK` with a JSON body containing `student_id`, `trigger` (e.g. `high_quality_learning`, `skill_gap_detected`), and any relevant context. The workflow will generate personalised recommendations and store them in the `student_recommendations` table.
- **Scheduled analysis** – The knowledge graph analyzer workflow runs every six hours by default. Adjust the schedule within the workflow’s trigger node if needed.

## Notes

- The workflows rely on Supabase tables such as `educational_activities`, `student_competencies`, `learning_analytics` and `student_recommendations`. Ensure these tables (and any other required tables) exist in your database. Refer to the **Zep Complete Setup Guide** for migration scripts and schema definitions.
- If you modify the recommendation logic or add new competencies, update the helper functions within the relevant function nodes of the workflows accordingly.
- Always **activate** your workflows after importing and setting environment variables, otherwise webhooks will not respond.

With these workflows in place, your Expo Go app can seamlessly record learning events, build student knowledge graphs, and deliver AI‑powered recommendations via Supabase and Zep.
